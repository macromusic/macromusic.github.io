<!DOCTYPE html>
  <html lang="ja">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <meta http-equiv="X-UA-Compatible" content="ie=edge" />
      <title>Document</title>
    </head>
    <body>
      <div>macro sample</div>
      <pre>
'Includes x

Option Explicit
Option Base 1

'◆ModuleProc名_
'Rev.001

'//モジュールメモリ
  Private Const meMstrMdlName As String = "xRefMdl"

'//モジュール内定数

'//出力制御信号
  Private myXbisCmpltFlag As Boolean

'//出力データ
  Private myZdouFltrAnglGo() As Double, myZdouFltrAnglBk() As Double    'フィルタ後Angle
  Private myZdouFltrVop1Go() As Double, myZdouFltrVop1Bk() As Double    'フィルタ後Vout1[%VDD]
  Private myZdouFltrVop2Go() As Double, myZdouFltrVop2Bk() As Double    'フィルタ後Vout2[%VDD]
  Private myZdouFltrDnlAnglGo() As Double, myZdouFltrDnlAnglBk() As Double  'フィルタ後DNL用Angle
  Private myZdouFltrDnlVop1Go() As Double, myZdouFltrDnlVop1Bk() As Double  'フィルタ後DNL用Vout1[%VDD]
  Private myZdouFltrDnlVop2Go() As Double, myZdouFltrDnlVop2Bk() As Double  'フィルタ後DNL用Vout2[%VDD]

'//入力制御信号

'//入力データ
  Private myZdouAnglGo() As Double, myZdouAnglBk() As Double            'Angle
  Private myZdouVop1Go() As Double, myZdouVop1Bk() As Double            'Vout1[%VDD]
  Private myZdouVop2Go() As Double, myZdouVop2Bk() As Double            'Vout2[%VDD]

'//モジュール内変数_制御信号
  Private myXbisExitFlag As Boolean

'//モジュール内変数_データ
  Private myXlonCalRowCnt As Long, myXlonCalColCnt As Long, myZdouCalData() As Double
  Private myZdouTmpData() As Double

'iniP_モジュール内変数を初期化する
Private Sub initializeModuleVariables()
    myXbisExitFlag = False

    Erase myZdouOrgData
    myXlonCalRowCnt = Empty: myXlonCalColCnt = Empty: Erase myZdouCalData
End Sub

'-----------------------------------------------------------------------------------------------

'PublicP_
Public Sub callProc(myXbisCmpltFlagOUT As Boolean)

'//出力変数を初期化
    myXbisCmpltFlagOUT = False

'//処理実行
    Call ctrProc
    If myXbisCmpltFlag = False Then Exit Sub

'//出力変数に格納
    myXbisCmpltFlagOUT = myXbisCmpltFlag

End Sub

'CtrlP_
Private Sub ctrProc()
    Call initializeOutputVariables
    Call initializeModuleVariables

'//C:制御用変数を設定
    Call setControlVariables

'//S:
    Call snsProc
    If myXbisExitFlag = True Then GoTo ExitPath
'    Debug.Print "PassFlag: " & meMstrMdlName & "2"     'PassFlag

'//P:
    Call prsProc
    If myXbisExitFlag = True Then GoTo ExitPath
'    Debug.Print "PassFlag: " & meMstrMdlName & "3"     'PassFlag

'//Run:
    Call runProc
    If myXbisExitFlag = True Then GoTo ExitPath
'    Debug.Print "PassFlag: " & meMstrMdlName & "4"     'PassFlag

    myXbisCmpltFlag = True
ExitPath:
    Call initializeModuleVariables
End Sub

'iniP_出力変数を初期化する
Private Sub initializeOutputVariables()
    myXbisCmpltFlag = False
End Sub

'SetP_制御用変数を設定する
Private Sub setControlVariables()
    
    myXbinOutlierFltrOptn
    myXlonOutCnt
    myXlonMvAvrgCnt
    myXdouDcmtAngl
    myXlonDnlMvAvrgCnt
    myXdouDnlDcmtAngl

End Sub

'SnsP_
Private Sub snsProc()
    myXbisExitFlag = False

    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'PrcsP_
Private Sub prsProc()
    myXbisExitFlag = False
    
    Call MsubProcGo1
    Call MsubProcGo2
    Call MsubProcGo3
    Call MsubProcGo4
    
    Call MsubProcBk1
    Call MsubProcBk2
    Call MsubProcBk3
    Call MsubProcBk4

    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'RunP_
Private Sub runProc()
    myXbisExitFlag = False

    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'===============================================================================================

'モジュール内Ｐ_
Private Sub MsubProcGo1()
    myXbisExitFlag = False
    
'//Vop1Goの処理
    Erase myZdouCalData: Erase myZdouTmpData
    If myXbinOutlierFltrOptn = True Then
        myZdouCalData() = myZdouVop1Go()
        Call COutlierFltr
        If myXlonCalRowCnt <= 0 Or myXlonCalColCnt <= 0 Then GoTo ExitPath
        myZdouTmpData() = myZdouCalData()
    Else
        myZdouTmpData() = myZdouVop1Go()
    End If
    
    If myXlonMvAvrgCnt > 0 Then
        Call CMvAvrg
        If myXlonCalRowCnt <= 0 Or myXlonCalColCnt <= 0 Then GoTo ExitPath
        myZdouFltrVop1Go() = myZdouCalData()
    Else
        myZdouFltrVop1Go() = myZdouCalData()
    End If

    Erase myZdouCalData
    If myXlonDnlMvAvrgCnt > 0 Then
        myZdouCalData() = myZdouTmpData()
        Call CMvAvrg
        If myXlonCalRowCnt <= 0 Or myXlonCalColCnt <= 0 Then GoTo ExitPath
        myZdouFltrDnlVop1Go() = myZdouCalData()
    Else
        myZdouFltrDnlVop1Go() = myZdouCalData()
    End If
    
    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'モジュール内Ｐ_
Private Sub MsubProcGo2()
    myXbisExitFlag = False

    If myXlonOutCnt = 1 Then Exit Sub
    
'//Vop2Goの処理
    Erase myZdouCalData: Erase myZdouTmpData
    If myXbinOutlierFltrOptn = True Then
        myZdouCalData() = myZdouVop2Go()
        Call COutlierFltr
        If myXlonCalRowCnt <= 0 Or myXlonCalColCnt <= 0 Then GoTo ExitPath
        myZdouTmpData() = myZdouCalData()
    Else
        myZdouTmpData() = myZdouVop2Go()
    End If
    
    If myXlonMvAvrgCnt > 0 Then
        Call CMvAvrg
        If myXlonCalRowCnt <= 0 Or myXlonCalColCnt <= 0 Then GoTo ExitPath
        myZdouFltrVop2Go() = myZdouCalData()
    Else
        myZdouFltrVop2Go() = myZdouCalData()
    End If

    Erase myZdouCalData
    If myXlonDnlMvAvrgCnt > 0 Then
        myZdouCalData() = myZdouTmpData()
        Call CMvAvrg
        If myXlonCalRowCnt <= 0 Or myXlonCalColCnt <= 0 Then GoTo ExitPath
        myZdouFltrDnlVop2Go() = myZdouCalData()
    Else
        myZdouFltrDnlVop2Go() = myZdouCalData()
    End If

    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'モジュール内Ｐ_
Private Sub MsubProcGo3()
    myXbisExitFlag = False

    If myXdouDcmtAngl <= 0 Then Exit Sub
    
'//2個の2次元数値配列を1個の2次元配列に左右で結合
    Call PfixArrayColumnCombineNumeric( _
            myXlonCalRowCnt, myXlonCalColCnt, myZdouCalData, _
            myZdouAnglGo, myZdouFltrVop1Go)
    If myXlonCalRowCnt <= 0 Or myXlonCalColCnt <= 0 Then GoTo ExitPath
    
    If myXlonOutCnt = 2 Then
        Erase myZdouTmpData
        myZdouTmpData() = myZdouCalData()
        Call PfixArrayColumnCombineNumeric( _
                myXlonCalRowCnt, myXlonCalColCnt, myZdouCalData, _
                myZdouTmpData, myZdouFltrVop2Go)
        If myXlonCalRowCnt <= 0 Or myXlonCalColCnt <= 0 Then GoTo ExitPath
    End If

'//VopGoの処理
    Call CNumDcmtFltr
    If myXlonCalRowCnt <= 0 Or myXlonCalColCnt <= 0 Then GoTo ExitPath
    
'//2次元数値配列を指定列で2個の配列に分割
  Dim myXlonSpltCol As Long, myXlonLftColCnt As Long, myXlonRghtColCnt As Long
    myXlonSpltCol = 1
    Erase myZdouTmpData
    Call PfixArrayColumnSplitNumeric( _
            myXlonLftColCnt, myZdouFltrAnglGo, myXlonRghtColCnt, myZdouTmpData, _
            myZdouCalData, myXlonSpltCol)
    If myXlonLftColCnt <= 0 Or myXlonRghtColCnt <= 0 Then GoTo ExitPath

    If myXlonOutCnt = 1 Then
        Erase myZdouFltrVop1Go
        myZdouFltrVop1Go() = myZdouTmpData()
    ElseIf myXlonOutCnt = 2 Then
        myXlonSpltCol = 1
        Call PfixArrayColumnSplitNumeric( _
                myXlonLftColCnt, myZdouFltrVop1Go, myXlonRghtColCnt, myZdouFltrVop2Go, _
                myZdouTmpData, myXlonSpltCol)
        If myXlonLftColCnt <= 0 Or myXlonRghtColCnt <= 0 Then GoTo ExitPath
    End If
    
    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'モジュール内Ｐ_
Private Sub MsubProcGo4()
    myXbisExitFlag = False

    If myXdouDnlDcmtAngl <= 0 Then Exit Sub
    
'//2個の2次元数値配列を1個の2次元配列に左右で結合
    Call PfixArrayColumnCombineNumeric( _
            myXlonCalRowCnt, myXlonCalColCnt, myZdouCalData, _
            myZdouAnglGo, myZdouFltrDnlVop1Go)
    If myXlonCalRowCnt <= 0 Or myXlonCalColCnt <= 0 Then GoTo ExitPath
    
    If myXlonOutCnt = 2 Then
        Erase myZdouTmpData
        myZdouTmpData() = myZdouCalData()
        Call PfixArrayColumnCombineNumeric( _
                myXlonCalRowCnt, myXlonCalColCnt, myZdouCalData, _
                myZdouTmpData, myZdouFltrDnlVop2Go)
        If myXlonCalRowCnt <= 0 Or myXlonCalColCnt <= 0 Then GoTo ExitPath
    End If

'//VopGoの処理
    Call CNumDcmtFltr
    If myXlonCalRowCnt <= 0 Or myXlonCalColCnt <= 0 Then GoTo ExitPath
    
'//2次元数値配列を指定列で2個の配列に分割
  Dim myXlonSpltCol As Long, myXlonLftColCnt As Long, myXlonRghtColCnt As Long
    myXlonSpltCol = 1
    Erase myZdouTmpData
    Call PfixArrayColumnSplitNumeric( _
            myXlonLftColCnt, myZdouFltrDnlAnglGo, myXlonRghtColCnt, myZdouTmpData, _
            myZdouCalData, myXlonSpltCol)
    If myXlonLftColCnt <= 0 Or myXlonRghtColCnt <= 0 Then GoTo ExitPath

    If myXlonOutCnt = 1 Then
        Erase myZdouFltrDnlVop1Go
        myZdouFltrDnlVop1Go() = myZdouTmpData()
    ElseIf myXlonOutCnt = 2 Then
        myXlonSpltCol = 1
        Call PfixArrayColumnSplitNumeric( _
                myXlonLftColCnt, myZdouFltrDnlVop1Go, myXlonRghtColCnt, myZdouFltrDnlVop2Go, _
                myZdouTmpData, myXlonSpltCol)
        If myXlonLftColCnt <= 0 Or myXlonRghtColCnt <= 0 Then GoTo ExitPath
    End If
    
    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'===============================================================================================

 '定型Ｐ_2個の2次元数値配列を1個の2次元配列に左右で結合する
Private Sub PfixArrayColumnCombineNumeric( _
            myXlonNewRowCnt As Long, myXlonNewColCnt As Long, _
            myZdouNewData() As Double, _
            ByRef myZdouLftOrg() As Double, ByRef myZdouRghtOrg() As Double)
'myZdouNewData(i, j) : 結合後のデータ配列
'myZdouLftOrg(i, j)  : 結合前の前半部の元データ配列
'myZdouRghtOrg(i, j) : 結合前の後半部の元データ配列
    myXlonNewRowCnt = Empty: myXlonNewColCnt = Empty: Erase myZdouNewData
  Dim myXdouTmp As Double, Li As Long
    On Error GoTo ExitPath
    Li = LBound(myZdouUpOrg, 2)
    myXdouTmp = myZdouLftOrg(Li, Li): myXdouTmp = myZdouRghtOrg(Li, Li)
    On Error GoTo 0
  Dim myXlonLftCnt As Long, myXlonRghtCnt As Long
    myXlonLftCnt = UBound(myZdouLftOrg, 2) - LBound(myZdouLftOrg, 2) + 1
    myXlonRghtCnt = UBound(myZdouRghtOrg, 2) - LBound(myZdouRghtOrg, 2) + 1
  Dim myZlonTmp(1) As Long, Lo As Long: Lo = LBound(myZlonTmp)
  Dim i As Long, j As Long, n As Long: n = Lo - 1
    If UBound(myZdouLftOrg, 1) <> UBound(myZdouRghtOrg, 1) Then Exit Sub
    myXlonNewRowCnt = UBound(myZdouLftOrg, 1) - LBound(myZdouLftOrg, 1) + 1
    myXlonNewColCnt = myXlonLftCnt + myXlonRghtCnt
    i = myXlonNewRowCnt + Lo - 1: j = myXlonNewColCnt + Lo - 1
    ReDim myZdouNewData(i, j) As Double
    For j = LBound(myZdouLftOrg, 2) To UBound(myZdouLftOrg, 2)
        n = n + 1
        For i = LBound(myZdouLftOrg, 1) To UBound(myZdouLftOrg, 1)
            myZdouNewData(i, n) = myZdouLftOrg(i, j)
        Next i
    Next j
    For j = LBound(myZdouRghtOrg, 2) To UBound(myZdouRghtOrg, 2)
        n = n + 1
        For i = LBound(myZdouRghtOrg, 1) To UBound(myZdouRghtOrg, 1)
            myZdouNewData(i, n) = myZdouRghtOrg(i, j)
        Next i
    Next j
ExitPath:
End Sub

 '定型Ｐ_2次元数値配列を指定列で2個の配列に分割する
Private Sub PfixArrayColumnSplitNumeric( _
            myXlonLftColCnt As Long, myZdouLft() As Double, _
            myXlonRghtColCnt As Long, myZdouRght() As Double, _
            ByRef myZdouOrgData() As Double, ByVal myXlonSpltCol As Long)
'myZdouLft(i, j)  : 分割後の左側データ配列
'myZdouRght(i, j) : 分割後の右側データ配列
'myZdouOrgData(i, j) : 元データ配列
'myXlonSpltCol : 分割する列番号を指定(指定列を含む右側を分割)
    myXlonLftColCnt = Empty: Erase myZdouLft
    myXlonRghtColCnt = Empty: Erase myZdouRght
  Dim myXdouTmp As Double, Li As Long
    On Error GoTo ExitPath
    Li = LBound(myZdouOrgData, 2): myXdouTmp = myZdouOrgData(Li, Li)
    On Error GoTo 0
    If myXlonSpltCol < LBound(myZdouOrgData, 2) + 1 _
        Or myXlonSpltCol > UBound(myZdouOrgData, 2) Then Exit Sub
  Dim myZlonTmp(1) As Long, Lo As Long: Lo = LBound(myZlonTmp)
  Dim i As Long, j As Long, m As Long, n As Long: m = Lo - 1: n = Lo - 1
    myXlonLftColCnt = myXlonSpltCol - LBound(myZdouOrgData, 2)
    myXlonRghtColCnt = UBound(myZdouOrgData, 2) - myXlonSpltCol + 1
    i = UBound(myZdouOrgData, 1)
    j = myXlonLftColCnt + Lo - 1: ReDim myZdouLft(i, j) As Double
    j = myXlonRghtColCnt + Lo - 1: ReDim myZdouRght(i, j) As Double
    For j = LBound(myZdouOrgData, 2) To myXlonSpltCol - 1
        m = m + 1
        For i = LBound(myZdouOrgData, 1) To UBound(myZdouOrgData, 1)
            myZdouLft(i, m) = myZdouOrgData(i, j)
        Next i
    Next j
    For j = myXlonSpltCol To UBound(myZdouOrgData, 2)
        n = n + 1
        For i = LBound(myZdouOrgData, 1) To UBound(myZdouOrgData, 1)
            myZdouRght(i, n) = myZdouOrgData(i, j)
        Next i
    Next j
ExitPath:
End Sub

'DummyＰ_
Private Sub MsubDummy()
End Sub

'===============================================================================================

'◆ModuleProc名_
Private Sub callxRefMdl()
  Dim myXbisCompFlag As Boolean
    Call xRefMdl.callProc( _
            myXbisCompFlag, myXbisFlag, myXvarField, myXobjObject, _
            myXbisFlagIN, myXvarFieldIN, myXobjObjectIN)
'    Call variablesOfxRefMdl(myXlonDataCnt, myXvarField)     'Debug.Print
End Sub
Private Sub variablesOfxRefMdl( _
            ByVal myXlonDataCnt As Long, ByRef myZvarField As Variant)
'//xRefMdl内から出力した変数の内容確認
    Debug.Print "データ: " & myZvarField
    Debug.Print "データ数: " & myXlonDataCnt
    If myXlonDataCnt <= 0 Then Exit Sub
  Dim k As Long
    For k = LBound(myZvarField) To UBound(myZvarField)
        Debug.Print "データ" & k & ": " & myZvarField(k)
    Next k
  Dim i As Long, j As Long
    For i = LBound(myZvarField, 1) To UBound(myZvarField, 1)
        For j = LBound(myZvarField, 2) To UBound(myZvarField, 2)
            Debug.Print "データ" & i & "," & j & ": " & myZvarField(i, j)
        Next j
    Next i
End Sub

      <br></pre>
    </body>
  </html>
