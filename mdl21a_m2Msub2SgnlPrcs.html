<!DOCTYPE html>
  <html lang="ja">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <meta http-equiv="X-UA-Compatible" content="ie=edge" />
      <title>Document</title>
    </head>
    <body>
      <div>MacroSample</div>
      <pre>
'Includes IntfcSgnlPrcs
'Includes xcRefSgnlPrcsImplIntfc
'Includes x

Option Explicit
Option Base 1

'◆ModuleProc名_Interfaceを使用して信号処理を実行する
'Rev.001
  
'//モジュールメモリ
  Private Const meMstrMdlName As String = "m2Msub2SgnlPrcs"
    
'//出力制御信号
  Private myXbisCmpltFlag As Boolean
  
'//出力データ
  Private myXlonCalDataCnt As Long, myZdouCalData() As Double
    'myZdouCalData(i, 1) : 演算結果データ
  Private myXlonHdrCnt As Long, myZstrHeader() As String
    'myZstrHeader(i, 1) : ヘッダーデータ
  
'//入力データ
  Private myZdouOrgData() As Double, myZvarCalPara() As Variant
    'myZdouOrgData(i, 1) : 元データ
    'myZvarCalPara(i, 1) : 演算用パラメータ
  
'//モジュール内変数_制御信号
  Private myXbisExitFlag As Boolean

'-----------------------------------------------------------------------------------------------

'PublicP_
Public Sub callProc( _
            myXbisCmpltFlagOUT As Boolean, _
            myXlonCalDataCntOUT As Long, myZdouCalDataOUT() As Double, _
            myXlonHdrCntOUT As Long, myZstrHeaderOUT() As String, _
            ByRef myZdouOrgDataIN() As Double, ByRef myZvarCalParaIN() As Variant)
    
'//入力変数を初期化
    Erase myZdouOrgData: Erase myZvarCalPara

'//入力変数を取り込み
    myZdouOrgData() = myZdouOrgDataIN()
    myZvarCalPara() = myZvarCalParaIN()
    
'//出力変数を初期化
    myXbisCmpltFlagOUT = False
    
    myXlonCalDataCntOUT = Empty: Erase myZdouCalDataOUT
    myXlonHdrCntOUT = Empty: Erase myZstrHeaderOUT
    
'//処理実行
    Call ctrProc
    If myXbisCmpltFlag = False Then Exit Sub
    
'//出力変数に格納
    myXbisCmpltFlagOUT = myXbisCmpltFlag
    
    If myXlonCalDataCnt <= 0 Then GoTo ExitPath
    myXlonCalDataCntOUT = myXlonCalDataCnt
    myZdouCalDataOUT() = myZdouCalData()
    
    If myXlonHdrCnt <= 0 Then GoTo ExitPath
    myXlonHdrCntOUT = myXlonHdrCnt
    myZstrHeaderOUT() = myZstrHeader()

ExitPath:
End Sub

'CtrlP_
Private Sub ctrProc()
    myXbisCmpltFlag = False
    myXlonCalDataCnt = Empty: Erase myZdouCalData
    myXlonHdrCnt = Empty: Erase myZstrHeader
    
    On Error GoTo ExitPath
  Dim Li As Long, myXdouTmp As Variant, myXvarTmp As Variant
    Li = LBound(myZdouOrgData, 1)
    myXdouTmp = myZdouOrgData(Li, Li)
    On Error GoTo 0
   
'//P:
    Call prsProc1
    If myXbisExitFlag = True Then GoTo ExitPath
'    Debug.Print "PassFlag: " & meMstrMdlName & "1"     'PassFlag
   
'//P:
    Call prsProc2
    If myXbisExitFlag = True Then GoTo ExitPath
'    Debug.Print "PassFlag: " & meMstrMdlName & "2"     'PassFlag
   
''//P:
'    Call prsProc3
'    If myXbisExitFlag = True Then GoTo ExitPath
''    Debug.Print "PassFlag: " & meMstrMdlName & "3"     'PassFlag
    
    myXbisCmpltFlag = True
ExitPath:
End Sub

'PrcsP_
Private Sub prsProc1()
    myXbisExitFlag = False
    
  Dim myZlonTmp(1) As Long, Lo As Long: Lo = LBound(myZlonTmp)
  Dim Li As Long: Li = LBound(myZdouOrgData, 1)
  Dim Ui As Long: Ui = UBound(myZdouOrgData, 1)
  Dim i As Long, j As Long
    
'//Headerの設定
    myXlonHdrCnt = 1
    i = myXlonHdrCnt + Lo - 1
    j = Lo + 0
    ReDim Preserve myZstrHeader(i, j) As String
    
    myZstrHeader(Lo + 0, j) = "n1"
    
'//データ演算
    myXlonCalDataCnt = Ui - Li + 1
    ReDim Preserve myZdouCalData(Ui, Lo + 0) As Double
    
    For i = Li To Ui
        myZdouCalData(i, Lo + 0) = myZdouOrgData(i, Li) * myZvarCalPara(Li, Li)
    Next i
    
    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'PrcsP_
Private Sub prsProc2()
    myXbisExitFlag = False
    
  Dim Li As Long: Li = LBound(myZdouCalData, 1)
  Dim Ui As Long: Ui = UBound(myZdouCalData, 1)
  Dim i As Long, j As Long
    
'//Headerの設定
    i = myXlonHdrCnt + Li - 1
    j = Li + 1
    ReDim Preserve myZstrHeader(i, j) As String
    
    myZstrHeader(Li + 0, j) = "n2"
    
'//データ演算
    ReDim Preserve myZdouCalData(Ui, j) As Double
    
    For i = Li To Ui
        myZdouCalData(i, j) = myZdouCalData(i, Li) * myZvarCalPara(Li, Li)
    Next i
    
    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'PrcsP_
Private Sub prsProc3()
    myXbisExitFlag = False
    
  Dim Li As Long: Li = LBound(myZdouCalData, 1)
  Dim Ui As Long: Ui = UBound(myZdouCalData, 1)
  Dim i As Long, j As Long
    
'//Headerの設定
    i = myXlonHdrCnt + Li - 1
    j = Li + 1
    ReDim Preserve myZstrHeader(i, j) As String
    
    myZstrHeader(Li + 0, j) = "n2"
    
'//データ演算
    ReDim Preserve myZdouCalData(Ui, j) As Double
    
    For i = Li To Ui
        myZdouCalData(i, j) = myZdouCalData(i, Li) * myZvarCalPara(Li, Li)
    Next i
    
    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'===============================================================================================

'DummyＰ_
Private Sub MsubDummy()
End Sub

'===============================================================================================

'◆ModuleProc名_
Private Sub callm2Msub2SgnlPrcs()
  Dim myZdouOrgData() As Double, myZvarCalPara() As Variant
    'myZdouOrgData(i, 1) : 元データ
    'myZvarCalPara(i, 1) : 演算用パラメータ
  Dim myXlonHdrCnt As Long, myZstrHeader() As String
    'myZstrHeader(i, 1) : ヘッダーデータ
  Dim myXbisCompFlag As Boolean
  Dim myXlonCalDataCnt As Long, myZdouCalData() As Double
    'myZdouCalData(i, 1) : 演算結果データ
    Call m2Msub2SgnlPrcs.callProc( _
            myXbisCompFlag, myXlonCalDataCnt, myZdouCalData, myXlonHdrCnt, myZstrHeader, _
            myZdouOrgData, myZvarCalPara)
    Call variablesOfm2Msub2SgnlPrcs(myXlonCalDataCnt, myZdouCalData)    'Debug.Print
End Sub
Private Sub variablesOfm2Msub2SgnlPrcs( _
            ByVal myXlonDataCnt As Long, ByRef myZvarField As Variant)
'//m2Msub2SgnlPrcs内から出力した変数の内容確認
    Debug.Print "データ数: " & myXlonDataCnt
    If myXlonDataCnt <= 0 Then Exit Sub
  Dim i As Long, j As Long
    For i = LBound(myZvarField, 1) To UBound(myZvarField, 1)
        For j = LBound(myZvarField, 2) To UBound(myZvarField, 2)
            Debug.Print "データ" & i & "," & j & ": " & myZvarField(i, j)
        Next j
    Next i
End Sub

      <br></pre>
    </body>
  </html>
