<!DOCTYPE html>
  <html lang="ja">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <meta http-equiv="X-UA-Compatible" content="ie=edge" />
      <title>Document</title>
    </head>
    <body>
      <div>MacroSample</div>
      <pre>
'Includes PfncvarUniformRandomNumber
'Includes PfncvarStandardNormalRandomNumber
'Includes PfncvarNormalRandomNumber
'Includes PfncvarRangeNormalRandomNumber
'Includes PfncbisCheckArrayDimension

Option Explicit
Option Base 1

'◆ClassProc名_乱数を生成する
'Rev.001
  
'//モジュールメモリ
  Private Const meMstrMdlName As String = "CRndmNmbr"
  
'//PropertyGet_出力制御信号
  Private myXbisCmpltFlag As Boolean
  
'//PropertyGet_出力データ
  Private myXdouRndNum As Double
  Private myXlonRndDataCnt As Long, myZdouRndData() As Double
  
'//PropertySetLet_入力制御信号
  Private myXlonRndType As Long
  
'//PropertySetLet_入力データ
  Private myXdouMean As Double, myXdouDev As Double, myXdouStDev As Double, _
            myXdouLSL As Double, myXdouUSL As Double
  Private myXlonRptN As Long

'//モジュール内変数_制御信号
  Private myXbisExitFlag As Boolean

'iniP_モジュール内変数を初期化する
Private Sub initializeModuleVariables()
    myXbisExitFlag = False
End Sub

'-----------------------------------------------------------------------------------------------

Public Property Get getCmpltFlag() As Boolean
    getCmpltFlag = myXbisCmpltFlag
End Property

Public Property Get getRndNum() As Double
    getRndNum = myXdouRndNum
'myXdouRndNum : 乱数
End Property

Public Property Get getRndDataCnt() As Long
    getRndDataCnt = myXlonRndDataCnt
End Property

Public Property Get getRndDataAry(ByVal i As Long) As Double
    getRndDataAry = myZdouRndData(i)
'myZdouRndData(i) : 乱数データ
End Property

'iniP_出力変数を初期化する
Private Sub initializeOutputVariables()
    myXbisCmpltFlag = False
    myXlonRndDataCnt = Empty: Erase myZdouRndData
End Sub

'checkP_出力変数内容を確認する
Private Sub checkOutputVariables()
    myXbisExitFlag = False
    
    If myXlonRndDataCnt <= 0 Then GoTo ExitPath
    If PfncbisCheckArrayDimension(myZdouRndData, 1) = False Then GoTo ExitPath
    
    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'-----------------------------------------------------------------------------------------------

Public Property Let letRndType(ByVal RHS As Long)
    myXlonRndType = RHS
'myXlonRndType = 1 : 一様乱数を生成
'myXlonRndType = 2 : 標準正規乱数を生成
'myXlonRndType = 3 : 正規乱数を生成
'myXlonRndType = 4 : 指定範囲内の正規乱数を生成
End Property

Public Property Let letMean(ByVal RHS As Double)
    myXdouMean = RHS
End Property

Public Property Let letDev(ByVal RHS As Double)
    myXdouDev = RHS
End Property

Public Property Let letStDev(ByVal RHS As Double)
    myXdouStDev = RHS
End Property

Public Property Let letLSL(ByVal RHS As Double)
    myXdouLSL = RHS
End Property

Public Property Let letUSL(ByVal RHS As Double)
    myXdouUSL = RHS
End Property

Public Property Let letRptN(ByVal RHS As Long)
    myXlonRptN = RHS
'myXlonRptN = 1 : 1個の乱数を生成
'myXlonRptN = N : N個の乱数を生成
End Property

'checkP_入力変数内容を確認する
Private Sub checkInputVariables()
    myXbisExitFlag = False
    
    If myXlonRndType < 1 Or myXlonRndType > 4 Then GoTo ExitPath
    
    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'-----------------------------------------------------------------------------------------------

'PublicF_
Public Function fncdouRndNum() As Double
    fncdouRndNum = Empty
    myXlonRptN = 1
    Call ctrProc
    fncdouRndNum = myXdouRndNum
End Function

'CtrlP_
Private Sub ctrProc()
    Call initializeOutputVariables
    Call initializeModuleVariables
    Call checkInputVariables: If myXbisExitFlag = True Then GoTo ExitPath
'    Debug.Print "PassFlag: " & meMstrMdlName & "1"     'PassFlag
    
'//C:分岐
    If myXlonRptN = 1 Then
    '//P:1個の乱数を生成
        Call prsProc1
        
    Else
    '//P:N個の乱数を生成
        Call prsProc2
    End If
    
    Call checkOutputVariables: If myXbisExitFlag = True Then GoTo ExitPath
    myXbisCmpltFlag = True
ExitPath:
    Call initializeModuleVariables
End Sub

'-----------------------------------------------------------------------------------------------

'PublicP_
Public Sub exeProc()
    Call ctrProc
End Sub

'CtrlP_
Private Sub ctrProc()
    Call initializeOutputVariables
    Call initializeModuleVariables
    Call checkInputVariables: If myXbisExitFlag = True Then GoTo ExitPath
'    Debug.Print "PassFlag: " & meMstrMdlName & "1"     'PassFlag
    
'//C:分岐
    If myXlonRptN = 1 Then
    '//P:1個の乱数を生成
        Call prsProc1
        
    Else
    '//P:N個の乱数を生成
        Call prsProc2
    End If
    
    Call checkOutputVariables: If myXbisExitFlag = True Then GoTo ExitPath
    myXbisCmpltFlag = True
ExitPath:
    Call initializeModuleVariables
End Sub

'PrcsP_1個の乱数を生成
Private Sub prsProc1()
    myXbisExitFlag = False
    
    If myXlonRndType = 1 Then
    '//一様乱数を生成
        myXdouRndNum = PfncvarUniformRandomNumber(myXdouMean, myXdouDev)
    
    ElseIf myXlonRndType = 2 Then
    '//標準正規乱数を生成
        myXdouRndNum = PfncvarStandardNormalRandomNumber
    
    ElseIf myXlonRndType = 3 Then
    '//正規乱数を生成
        myXdouRndNum = PfncvarNormalRandomNumber(myXdouMean, myXdouStDev)
    
    ElseIf myXlonRndType = 4 Then
    '//指定範囲内の正規乱数を生成
        myXdouRndNum = PfncvarRangeNormalRandomNumber( _
                        myXdouMean, myXdouStDev, myXdouLSL, myXdouUSL)
    
    Else
        GoTo ExitPath
    End If
    
    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'PrcsP_N個の乱数を生成
Private Sub prsProc2()
    myXbisExitFlag = False
    
    myXlonRndDataCnt = myXlonRptN
    ReDim myZdouRndData(myXlonRndDataCnt) As Double
    
  Dim k As Long
    If myXlonRndType = 1 Then
    '//一様乱数を生成
        For k = 1 To myXlonRptN
            myZdouRndData(k) = PfncvarUniformRandomNumber(myXdouMean, myXdouDev)
        Next k
    
    ElseIf myXlonRndType = 2 Then
    '//標準正規乱数を生成
        For k = 1 To myXlonRptN
            myZdouRndData(k) = PfncvarStandardNormalRandomNumber
        Next k
    
    ElseIf myXlonRndType = 3 Then
    '//正規乱数を生成
        For k = 1 To myXlonRptN
            myZdouRndData(k) = PfncvarNormalRandomNumber(myXdouMean, myXdouStDev)
        Next k
    
    ElseIf myXlonRndType = 4 Then
    '//指定範囲内の正規乱数を生成
        For k = 1 To myXlonRptN
            myZdouRndData(k) = PfncvarRangeNormalRandomNumber( _
                                myXdouMean, myXdouStDev, myXdouLSL, myXdouUSL)
        Next k
    
    Else
        GoTo ExitPath
    End If
    
    Exit Sub
ExitPath:
    myXbisExitFlag = True
End Sub

'-----------------------------------------------------------------------------------------------

 '定型Ｆ_一様乱数を生成する
Private Function PfncvarUniformRandomNumber( _
            ByVal myXdouMean As Double, ByVal myXdouDev As Double, _
            Optional ByVal coXlonDcml As Long = 22) As Variant
    PfncvarUniformRandomNumber = Empty
    If coXlonDcml > 22 Then Exit Function
  Dim myXdouBgn As Double, myXdouEnd As Double
    myXdouBgn = myXdouMean - myXdouDev
    myXdouEnd = myXdouMean + myXdouDev
  Dim myXdouRnd As Double
    myXdouRnd = myXdouBgn + Rnd() * (myXdouEnd - myXdouBgn)
    myXdouRnd = Round(myXdouRnd, coXlonDcml)
    PfncvarUniformRandomNumber = myXdouRnd
End Function

 '定型Ｆ_標準正規乱数を生成する
Private Function PfncvarStandardNormalRandomNumber( _
            Optional ByVal coXlonDcml As Long = 22) As Variant
    PfncvarStandardNormalRandomNumber = Empty
    If coXlonDcml > 22 Then Exit Function
  Dim myXdouRnd As Double
    On Error GoTo ExitPath
    myXdouRnd = Application.WorksheetFunction.NormSInv(Rnd())
    myXdouRnd = Round(myXdouRnd, coXlonDcml)
    PfncvarStandardNormalRandomNumber = myXdouRnd
ExitPath:
End Function

 '定型Ｆ_正規乱数を生成する
Private Function PfncvarNormalRandomNumber( _
            ByVal myXdouMean As Double, ByVal myXdouStDev As Double, _
            Optional ByVal coXlonDcml As Long = 22) As Variant
    PfncvarNormalRandomNumber = Empty
    If coXlonDcml > 22 Then Exit Function
  Dim myXdouRnd As Double
    On Error GoTo ExitPath
    myXdouRnd = Application.WorksheetFunction _
                    .NormInv(Rnd(), myXdouMean, myXdouStDev)
'    myXdouRnd = Application.WorksheetFunction.NormSInv(Rnd())
'    myXdouRnd = myXdouMean + myXdouStDev * myXdouRnd
    myXdouRnd = Round(myXdouRnd, coXlonDcml)
    PfncvarNormalRandomNumber = myXdouRnd
ExitPath:
End Function

 '定型Ｆ_指定範囲内の正規乱数を生成する
Private Function PfncvarRangeNormalRandomNumber( _
            ByVal myXdouMean As Double, ByVal myXdouStDev As Double, _
            ByVal myXdouLSL As Double, ByVal myXdouUSL As Double, _
            Optional ByVal coXlonDcml As Long = 22) As Variant
    PfncvarRangeNormalRandomNumber = Empty
    If myXdouUSL <= myXdouLSL Then Exit Function
    If coXlonDcml > 22 Then Exit Function
  Dim myXdouRnd As Double
  Dim myXbisExitLpFlag As Boolean: myXbisExitLpFlag = False
    On Error GoTo ExitPath
    Do While myXbisExitLpFlag = False
        myXdouRnd = Application.WorksheetFunction _
                        .NormInv(Rnd(), myXdouMean, myXdouStDev)
'        myXdouRnd = Application.WorksheetFunction.NormSInv(Rnd())
'        myXdouRnd = myXdouMean + myXdouStDev * myXdouRnd
        myXdouRnd = Round(myXdouRnd, coXlonDcml)
        If myXdouRnd >= myXdouLSL And myXdouRnd <= myXdouUSL Then _
            myXbisExitLpFlag = True
    Loop
    PfncvarRangeNormalRandomNumber = myXdouRnd
ExitPath:
End Function

 '定型Ｆ_配列変数の次元数が指定次元と一致するかをチェックする
Private Function PfncbisCheckArrayDimension( _
            ByRef myZvarDataAry As Variant, ByVal myXlonDmnsn As Long) As Boolean
    PfncbisCheckArrayDimension = False
    If IsArray(myZvarDataAry) = False Then Exit Function
    If myXlonDmnsn <= 0 Then Exit Function
  Dim myXlonTmp As Long, k As Long: k = 0
    On Error Resume Next
    Do
        k = k + 1: myXlonTmp = UBound(myZvarDataAry, k)
    Loop While Err.Number = 0
    On Error GoTo 0
    If k - 1 <> myXlonDmnsn Then Exit Function
    PfncbisCheckArrayDimension = True
End Function

'DummyＰ_
Private Sub CsubDummy()
End Sub

'===============================================================================================

''◆ClassProc名_乱数を生成する
'Private Sub instCRndmNmbr()
'  Dim myXbisCmpltFlag As Boolean
'  Dim myXdouRndNum As Double
'  Dim myXlonRndDataCnt As Long, myZdouRndData() As Double
'    'myZdouRndData(i) : 乱数データ
''//クラス内変数への入力
'  Dim myXlonRndType As Long
'    myXlonRndType = 1
'    'myXlonRndType = 1 : 一様乱数を生成
'    'myXlonRndType = 2 : 標準正規乱数を生成
'    'myXlonRndType = 3 : 正規乱数を生成
'    'myXlonRndType = 4 : 指定範囲内の正規乱数を生成
'  Dim myXdouMean As Double, myXdouDev As Double, myXdouStDev As Double, _
'        myXdouLSL As Double, myXdouUSL As Double
'    myXdouMean = 1
'    myXdouDev = 1
'    myXdouStDev = 1
'    myXdouLSL = 1
'    myXdouUSL = 10
'  Dim myXlonRptN As Long
'    myXlonRptN = 1
''//CRndmNmbrクラスモジュールのインスタンス生成
'  Dim myZlonTmp(1) As Long, L As Long: L = LBound(myZlonTmp)
'  Dim i As Long
'  Dim myXinsRndmNmbr As CRndmNmbr: Set myXinsRndmNmbr = New CRndmNmbr
'    With myXinsRndmNmbr
'    '//クラス内変数への入力
'        .letRndType = myXlonRndType
'        .letMean = myXdouMean
'        .letDev = myXdouDev
'        .letStDev = myXdouStDev
'        .letLSL = myXdouLSL
'        .letUSL = myXdouUSL
'        .letRptN = myXlonRptN
'    '//クラス内プロシージャの実行とクラス内変数からの出力
'        myXdouRndNum = .fncdouRndNum
'        .exeProc
'        myXbisCmpltFlag = .getCmpltFlag
'        myXlonRndDataCnt = .getRndDataCnt
'        If myXlonRndDataCnt <= 0 Then GoTo JumpPath
'        i = myXlonRndDataCnt - (1 - L): ReDim myZdouRndData(i) As Double
'        For i = 1 To myXlonRndDataCnt
'            myZdouRndData(i - (1 - L)) = .getRndDataAry(i)
'        Next i
'    End With
'JumpPath:
'    Set myXinsRndmNmbr = Nothing
'    Debug.Print "データ: " & myXdouRndNum
''    Call variablesOfCRndmNmbr(myXlonRndDataCnt, myZdouRndData)   'Debug.Print
'End Sub
'Private Sub variablesOfCRndmNmbr( _
'            ByVal myXlonDataCnt As Long, ByRef myZvarField As Variant)
''//CRndmNmbrクラス内から出力した変数の内容確認
'    Debug.Print "データ数: " & myXlonDataCnt
'    If myXlonDataCnt <= 0 Then Exit Sub
'  Dim k As Long
'    For k = LBound(myZvarField) To UBound(myZvarField)
'        Debug.Print "データ" & k & ": " & myZvarField(k)
'    Next k
'End Sub

      <br></pre>
    </body>
  </html>
